<!DOCTYPE html>
<html lang="en">
<meta http-equiv="Cache-Control" content="no-store" />
<head>
<meta charset="utf-8"/>
<script type="text/javascript" src="js/jquery-2.1.4.js"></script>
<script type="text/javascript" src="js/tableauwc-1.1.0.js"></script>
<script type="text/javascript">
  // Use anon self-executing function
  (function() {
    // Define our connector
    var myConnector = tableau.makeConnector();
    
    // Set-up column headers so Tableau knows about our fields and their datatypes (26 fields)
    myConnector.getColumnHeaders = function() {
      var fieldNames = ['time', 'summary', 'sunriseTime', 'sunsetTime', 'moonPhase', 'precipIntensity', 'precipIntensityMax', 'precipIntensityMaxTime', 'precipProbability', 'precipType', 'temperatureMin', 'temperatureMinTime', 'temperatureMax', 'temperatureMaxTime', 'apparentTemperatureMin', 'apparentTemperatureMinTime', 'apparentTemperatureMax', 'apparentTemperatureMaxTime', 'dewPoint', 'humidity', 'windSpeed', 'windBearing', 'visibility', 'cloudCover', 'pressure', 'ozone'];
      var fieldTypes = ['int', 'string', 'int', 'int', 'float', 'float', 'float', 'int', 'float', 'string', 'float', 'int', 'float', 'int', 'float', 'int', 'float', 'int', 'float', 'float', 'float', 'int', 'float', 'float', 'float', 'int'];
      
      tableau.headersCallback(fieldNames, fieldTypes);
    };
    
    /*
    
    bool
    date
    datetime
    float
    int
    string
*/
    
    /*
    
    "time": 1441350000,
				"summary": "Partly cloudy until evening.",
				"icon": "partly-cloudy-day",
				"sunriseTime": 1441373590,
				"sunsetTime": 1441421203,
				"moonPhase": 0.72,
				"precipIntensity": 0.0003,
				"precipIntensityMax": 0.0023,
				"precipIntensityMaxTime": 1441350000,
				"precipProbability": 0.01,
				"precipType": "rain",
				"temperatureMin": 48.85,
				"temperatureMinTime": 1441371600,
				"temperatureMax": 67.4,
				"temperatureMaxTime": 1441407600,
				"apparentTemperatureMin": 48.85,
				"apparentTemperatureMinTime": 1441371600,
				"apparentTemperatureMax": 67.4,
				"apparentTemperatureMaxTime": 1441407600,
				"dewPoint": 47.07,
				"humidity": 0.71,
				"windSpeed": 5.26,
				"windBearing": 355,
				"visibility": 8.95,
				"cloudCover": 0.38,
				"pressure": 1015.77,
				"ozone": 351
        */
    
    // Money function to get data
    
    // Set-up our URL
    myConnector.setLocation = function(latitude, longitude) {
      // Hard-code our Forecast.io API Key
      var apiKey = 'a328cf110f5d0b477e730b71c2cde8de';
      
      // Construct our URL for the API call
      var url = 'http://api.forecast.io/forecast/' + apiKey + '/' + latitude + ',' + longitude;
      
      tableau.connectionData = url;
      tableau.connectionName = 'Forecast.io Weather Data for ' + latitude + ' ' + longitude;
    }
    
    // Register the connector
    
    // UI -> use jQuery for button click handler
    $(document).ready(function(){
      $("#submitButton").click(function(event) {
      
      // Get our lat/long values that were provided
      var latitude = $('#latitude').val();
      var longitude = $('#longitude').val();
      latitude = latitude.trim();
      longitude = longitude.trim();
      
      // Make sure we have values before we proceed
      if (!latitude || !longitude) {
        return;
      } else {
        myConnector.setLocation(latitude, longitude);
        tableau.submit();
      }
    });         
    
  })();
  
</script>
</head>
  <body>
      Latitude:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="latitude" name="latitude" style="width: 150px;" /> (try 47.6716 for 98103)
      <br />
      Longitude: <input type="text" id="longitude" name="longitude" style="width: 150px;" /> (try -122.3411 for 98103)
      <br />
      <br />
      <button type="button" id="submitbutton">Get Weather Forecast</button>
  </body>
</html>